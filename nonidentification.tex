%!TEX root = ./main.tex
\section{Non-identification Based on First Moments}

\subsection{Mahajan's Approach}
Here we show that \citeauthor{Mahajan}'s proof of identification for an endogenous treatment is incorrect.
The problem is subtle so we give his argument in full detail.
We continue to supress dependence on the exogenous covariates $\mathbf{x}$.

The first step of \citeauthor{Mahajan}'s argument is to show that if one could recover the conditional mean function of $y$ given $T^*$, then a valid and relevant binary instrument would suffice to identify the treatment effect.  
\begin{assump}[Mahajan A2]\mbox{}
  \label{assump:A2} Suppose that $y = c+ \beta T^* + \varepsilon$ where
  \begin{enumerate}[(i)]
    \item $\mathbb{E}[\varepsilon|z]=0$
    \item $\mathbb{P}(T^*=1|z_k)\neq \mathbb{P}(T^*=1|z_\ell)$ for all $k\neq \ell$
    \item $\mathbb{P}(T = 1| T^* = 0, z) = \alpha_0$, $\mathbb{P}(T = 0| T^* = 1, z) = \alpha_1$
    \item $\alpha_0 + \alpha_1 \neq 1$
  \end{enumerate}
\end{assump}

\begin{lem}[Mahajan A2]
  \label{res:A2}
Under Assumption \ref{assump:A2}, knowledge of the mis-classification error rates $\alpha_0, \alpha_1$ suffices to identify $\beta$.
\end{lem}
\begin{proof}[Proof of Lemma \ref{res:A2}]
Since $z$ is a valid instrument that does not influence the mis-classification probabilities
\[\mathbb{E}[y|z_k] = c + \beta \mathbb{E}[T^*|z_k] + \mathbb{E}[\varepsilon|z_k] = c + \beta p_k^* = c + \beta \left( \frac{p_k - \alpha_0}{1 - \alpha_0 - \alpha_1} \right)\]
by Equation \ref{eq:pkstar}.
Since $p_k$ is observed, and $z$ takes on two values, this is a system of two linear equations in $c,\beta$ provided that $\alpha_0,\alpha_1$ are known.
A unique solution exists if and only if $p_1 \neq p_2$.
\end{proof}

In his Theorem 1, \cite{Mahajan} proves that $\alpha_0, \alpha_1$ can in fact be identified under the following assumptions.\footnote{Technically, one additional assumption is required, namely that the conditional mean of $y$ given $T^*$ and any covariates would be identified if $T^*$ were observed.}
\begin{assump}[Mahajan A1] Define $\nu = y - \mathbb{E}[y|T^*]$ so that by construction we have $\mathbb{E}[\nu|T^*]=0$. Assume that
  \label{assump:A1}
  \begin{enumerate}[(i)]
    \item $\mathbb{E}[\nu|T^*,T,z] = 0$.\footnote{This is \citeauthor{Mahajan}'s Equation (I).}
    \item $\mathbb{P}(T^*=1|z_k)\neq \mathbb{P}(T^*=1|z_\ell)$ for all $k\neq \ell$
    \item $\mathbb{P}(T = 1| T^* = 0, z) = \alpha_0$,  $\mathbb{P}(T = 0| T^* = 1, z) = \alpha_1$
    \item $\alpha_0 + \alpha_1 < 1$
    \item $\mathbb{E}[y|T^*=0]\neq \mathbb{E}[y|T^*=1]$
  \end{enumerate}
\end{assump}
\begin{lem}[Mahajan Theorem 1]
  \label{thm:1}
  Under Assumptions \ref{assump:A1}, the error rates $\alpha_0, \alpha_1$ are identified as is the conditional mean function $\mathbb{E}[y|T^*]$.
\end{lem}
\begin{proof}[Proof of Lemma \ref{thm:1}]
  See \cite{Mahajan} Appendix A.1. 
\end{proof}
Notice that the identification of the error rates in Lemma \ref{thm:1} does not depend on the interpretation of the conditional mean function $\mathbb{E}[y|T^*]$.
If $T^*$ is an exogenous treatment, the conditional mean coincides with the treatment effect; if it is endogenous, this is not the case.
Either way, the meaning of $\alpha_0, \alpha_1$ is unchanged: these parameters simply characterize the mis-classification process. 
Based on this observation, \cite{Mahajan} claims that he can rely on Lemma \ref{thm:1} to identify $\alpha_0,\alpha_1$ and thus the causal effect $\beta$ when the treatment is endogenous via Lemma \ref{res:A2}.
To do this, he must build a bridge between Assumption \ref{assump:A2} and Assumption \ref{assump:A1} that allows $T^*$ to be endogenous.
\cite{Mahajan} does this by imposing one additional assumption: Equation 11 in his paper.
\begin{assump}[Mahajan Equation 11]
  \label{assump:Eq11}
  Let $y = c + \beta T^* + \varepsilon$ where $\mathbb{E}[\varepsilon|T^*]$ may not be zero and suppose that 
  \[\mathbb{E}[\varepsilon|T^*,T,z] = \mathbb{E}[\varepsilon|T^*].\]
\end{assump}
\begin{lem}
  \label{res:Eq11}
  Suppose that $y = c + \beta T^* + \varepsilon$ where $E[\varepsilon|z]=0$ and define the unobserved projection error $\nu = y - \mathbb{E}[y|T^*]$.
  Then Assumption \ref{assump:Eq11} implies that $E[\nu|T^*,T,z]=0$, which is Assumption \ref{assump:A1}(i).
\end{lem}
\begin{proof}[Proof of Lemma \ref{res:Eq11}]
  Taking conditional expectations of the causal model,
  \[\mathbb{E}[y|T^*] = c + \beta T^* + \mathbb{E}[\varepsilon|T^*]\]
  which implies that 
  \[\nu = y - c - \beta T^* - \mathbb{E}[\varepsilon|T^*] = \varepsilon - \mathbb{E}[\varepsilon|T^*].\]
  Now, taking conditional expectations of both sides given $T^*,T,z$, we see that 
  \begin{align*}
  \mathbb{E}[\nu|T^*,T,z]&= \mathbb{E}[\varepsilon|T^*,T,z] - \mathbb{E}\left[ \mathbb{E}\left( \left.\varepsilon\right|T^* \right)\left. \right| T,T^*,z \right]\\
  &= \mathbb{E}[\varepsilon|T^*,T,z] - \mathbb{E}\left[ \left.\varepsilon\right|T^* \right] = 0
\end{align*}
by Assumption \ref{assump:Eq11}, since $\mathbb{E}[\varepsilon|T^*]$ is $(T^*,T,z)$--measurable.
\end{proof}

To summarize, \citeauthor{Mahajan}'s claim is equivalent to the proposition that under Assumptions \ref{assump:A2}(i), \ref{assump:A1}(ii)--(v), and \ref{assump:Eq11}, $\beta$ is identified even if $T^*$ is endogenous.
Although Lemmas \ref{res:A2}, \ref{thm:1} and \ref{res:Eq11} are all correct, \citeauthor{Mahajan}'s claim is not.
While Assumption \ref{assump:Eq11} does guarantee that Assumption \ref{assump:A1}(i) holds, when combined with Assumption \ref{assump:A2}(i) it also implies that \ref{assump:A1}(ii) fails if $T^*$ is endogenous.
The failure of Assumption \ref{assump:A1}(ii) in turn leads to a division by zero in the solution to the linear system following \citeauthor{Mahajan}'s displayed Equation 26: the system no longer has a unique solution so identification fails. 
\begin{pro}[Lack of a First Stage]
  \label{pro:FirstStage}
  Suppose that Assumptions \ref{assump:A2}(i) and \ref{assump:Eq11} hold and $\mathbb{E}[\varepsilon|T^*]\neq0$. Then $\mathbb{P}(T^*=1|z_1) = \mathbb{P}(T^*=1|z_2)$, violating Assumption \ref{assump:A1}(ii). 
\end{pro}
\begin{proof}[Proof of Proposition \ref{pro:FirstStage}]
  By the Law of Iterated Expectations,
  \begin{equation}
    \label{eq:NoSelection}
    \mathbb{E}[\varepsilon|T^*,z] = \mathbb{E}_{T|T^*,z}\left[\mathbb{E}\left(\varepsilon|T^*,T,z \right)  \right] = \mathbb{E}_{T|T^*,z}\left[\mathbb{E}\left(\varepsilon|T^* \right)  \right]
    = \mathbb{E}\left[ \varepsilon|T^* \right]
  \end{equation}
    where the second equality follows from Assumption \ref{assump:Eq11} and the final equality comes from the fact that $\mathbb{E}[\varepsilon|T^*]$ is $(T^*,z)$--measurable. 
  Using our notation from above let $u = c + \varepsilon$ and define $m^*_{tk}=\mathbb{E}[u|T^*=t,z=z_k]$.
  Since $c$ is a constant, by Equation \ref{eq:NoSelection} we see that $m^*_{01}=m^*_{02}$ and $m^*_{11}=m^*_{12}$.
  Now, by Assumption \ref{assump:A2}(i) we have $\mathbb{E}[\varepsilon|z]=0$ so that $\mathbb{E}[u|z_1]= \mathbb{E}[u|z_2] =c$.
  Again using iterated expectations, 
  \begin{align*}
    \mathbb{E}\left[u|z_1 \right] &= \mathbb{E}_{T^*|z_1}\left[\mathbb{E}\left( u|T^*,z_1 \right)  \right] = (1-p_1^*) m^*_{01} + p^*_1 m^*_{11}=c\\
    \mathbb{E}\left[u|z_2 \right] &= \mathbb{E}_{T^*|z_2}\left[\mathbb{E}\left( u|T^*,z_2 \right)  \right] = (1-p_2^*) m^*_{02} + p^*_2 m^*_{12}=c
  \end{align*}
  The preceding two equations, combined with $m^*_{01}=m^*_{02}$ and $m^*_{11}=m^*_{12}$ imply that $p_1^* = p_2^*$ unless $m^*_{01} = m^*_{11} = m^*_{02} = m^*_{12} = c$.
  But this four-way equality is ruled out by the assumption that $\mathbb{E}[\varepsilon|T^*]\neq0$. 
\end{proof}


\subsection{Generic Lack of Identification}
We have seen that \cite{Mahajan}'s approach cannot identify $\beta$ when the treatment is endogenous: Assumption \ref{assump:Eq11} in fact implies that the instrument is \emph{irrelevant}. 
But this alone does not establish that a valid instrument is insufficient to identify $\beta$ when the treatment is endogenous.
In particular, our equation counts from above appear to suggest that a valid instrument that takes on at least four values might suffice for identification.
Unfortunately, this is not the case as we now show.

\begin{thm}[Lack of Identification]
  \label{pro:Lack}
  Suppose that Assumption \ref{assump:A2} holds and additionally that $\mathbb{E}[\varepsilon|T^*,T,z]=\mathbb{E}[\varepsilon|T^*,z]$ (non-differential measurement error).  
  Then regardless of how many values $z$ takes on, generically $\beta$ is unidentified based on the observables contained in Table \ref{tab:observables}.
\end{thm}
\begin{proof}[Proof of Theorem \ref{pro:Lack}]
  The assumptions of this Theorem are the same as those used to derive Equations \ref{eq:MC0IV} and \ref{eq:MC1IV}. 
  These expressions, for $k = 1, \dots, K$ constitute the full set of available moment conditions.
  To establish lack of identification, we derive a parametric relationship between $\beta$ and the other model parameters such that, varying $\beta$ along this parametric relationship, the observables $(\hat{y}_{0k},\hat{y}_{1k})$ are unchanged for all $k$.   

  Recall from the discussion preceding Equation \ref{eq:wald} that the Wald estimator $\mathcal{W} = \beta/(1-\alpha_0-\alpha_1)$ is identified in this model so long as $K$ is at least 2. 
  Rearranging, we find that:
  \begin{align*}
    \alpha_0 &= (1-\alpha_1) - \beta/\mathcal{W} \\
    (p_k - \alpha_0) &= p_k - (1-\alpha_1) + \beta/\mathcal{W}\\
    1 - \alpha_0 &= \alpha_1 + \beta/\mathcal{W}
  \end{align*}
Substituting these into Equations \ref{eq:MC0IV} and \ref{eq:MC1IV} and summing the two, we find, after some algebra, that
\[\hat{y}_{0k} + \hat{y}_{1k} + \mathcal{W}(1-p_k) = c + \beta + \mathcal{W} \alpha_1.\]
Since the left-hand side of this expression depends only on observables and the identified quantity $\mathcal{W}$, this shows that the right-hand side is itself identified in this model.
For simplicity, we define $\mathcal{Q} = c + \beta + \mathcal{W}\alpha_1$.
Since $\mathcal{W}$ and $\mathcal{Q}$ are both identified, varying either \emph{necessarily} changes the observables, so we must hold both of them constant. 
We now show that Equations \ref{eq:MC0IV} and \ref{eq:MC1IV} can be expressed in terms of $\mathcal{W}$ and $\mathcal{Q}$.
Conveniently, this eliminates $\alpha_0$ from the system.
After some algebra, 
\begin{align}
  \label{eq:OtherSameEquation}
  \hat{y}_{0k} &= \alpha_1 (\mathcal{Q} - m^*_{1k}) + \beta(c-m^*_{1k})/\mathcal{W} + (1-p_k)\left[m^*_{1k} - \mathcal{W}\alpha_1\right]\\
  \hat{y}_{1k} &= (1-\alpha_1) \mathcal{Q} + \beta(m^*_{1k} - c)/\mathcal{W} - (1-p_k)\left[m^*_{1k} + \mathcal{W}(1-\alpha_1)\right]
  \label{eq:SimplifyMe}
\end{align}
Now, rearranging Equation \ref{eq:SimplifyMe} we see that
\begin{equation}
  \mathcal{Q} - \hat{y}_{1k} - \mathcal{W}(1-p_k) = \alpha_1 (\mathcal{Q} - m^*_{1k}) + \beta(c-m^*_{1k})/\mathcal{W} + (1-p_k)\left[m^*_{1k} - \mathcal{W}\alpha_1\right]
  \label{eq:SameEquation}
\end{equation}
Notice that the right-hand side of Equation \ref{eq:SameEquation} is the \emph{same} as that of Equation \ref{eq:OtherSameEquation} and that $\mathcal{Q} - \hat{y}_{1k} - \mathcal{W}(1-p_k)$ is precisely $\hat{y}_{0k}$.
In other words, given the constraint that $\mathcal{W}$ and $\mathcal{Q}$ must be held fixed, we only have \emph{one} equation for each value that the instrument takes on.
Finally, we can solve this equation for $m^*_{1k}$ as
\begin{equation}
  m^*_{1k} = \frac{\mathcal{W}(\hat{y}_{0k}-\alpha_1 \mathcal{Q}) - \beta(\mathcal{Q}-\beta-\mathcal{W}\alpha_1) + \mathcal{W}^2(1-p_k)\alpha_1}{\mathcal{W}(1-p_k - \alpha_1) - \beta}
  \label{eq:mSolve}
\end{equation}
using the fact that $c = \mathcal{Q} - \beta - \mathcal{W}\alpha_1$.
Equation \ref{eq:mSolve} is a manifold parameterized by $(\beta,\alpha_1)$ that is \emph{unique} to each value that the instrument takes on. 
Thus, by adjusting $\left\{ m^*_{1k} \right\}_{k=1}^K$ according to Equation \ref{eq:mSolve} we are free to vary $\beta$ while holding all observable moments fixed. 
\end{proof}

%Notice that Equation 20 breaks if $p_k = \alpha_0$. This is because it would reduce the pair of equations to an expression  kill the $m^*_{1k}$ term in the pair of equations for this particular value of $k$. This seems to be related to \cite{Hausman}

%Add some discussion of what this proof means, why there is a lack of identification intuitively, why adding more values for the instrument doesn't help, etc.
